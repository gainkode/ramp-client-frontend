<h3>{{ pageTitle }}</h3>
<div *ngIf="inProgress">
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  <br />
</div>
<div class="form-error-box" *ngIf="errorMessage !== ''">
  {{ errorMessage }}
</div>

<div class="table-responsive">
  <table mat-table *ngIf="errorMessage === ''" class="data-table" [dataSource]="transactions" matSort
    [matSortActive]="sortedField" matSortDirection="desc" matSortDisableClear multiTemplateDataRows>
    <!-- Transaction ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>Transaction ID</th>
      <td mat-cell *matCellDef="let element">{{ element.id }}</td>
    </ng-container>

    <!-- Created Column -->
    <ng-container matColumnDef="created">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Created
      </th>
      <td mat-cell *matCellDef="let element">{{ element.created }}</td>
    </ng-container>

    <!-- Executed Column -->
    <ng-container matColumnDef="executed">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Executed
      </th>
      <td mat-cell *matCellDef="let element">{{ element.executed }}</td>
    </ng-container>

    <!-- Transaction Type Column -->
    <ng-container matColumnDef="type">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Type
      </th>
      <td mat-cell *matCellDef="let element">
        {{ element.transactionTypeName }}
      </td>
    </ng-container>

    <!-- Instrument Column -->
    <ng-container matColumnDef="instrument">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Instrument
      </th>
      <td mat-cell *matCellDef="let element">{{ element.instrumentName }}</td>
    </ng-container>

    <!-- Payment Provider Column -->
    <ng-container matColumnDef="payment">
      <th mat-header-cell *matHeaderCellDef>Details</th>
      <td mat-cell *matCellDef="let element">
        <app-dropdown-item itemValue="{{ element?.instrumentDetails?.title }}"
          imageClass="{{ element?.instrumentDetails?.imgClass }}"
          imageSource="{{ element?.instrumentDetails?.imgSource }}">
        </app-dropdown-item>
      </td>
    </ng-container>

    <!-- Base Currency Column -->
    <ng-container matColumnDef="currencyToSpend">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Base coin
      </th>
      <td mat-cell *matCellDef="let element">{{ element.currencyToSpend }}</td>
    </ng-container>

    <!-- Base Amount Column -->
    <ng-container matColumnDef="amountToSpend">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Base value
      </th>
      <td mat-cell *matCellDef="let element">{{ element.amountToSpend }}</td>
    </ng-container>

    <!-- Fee Value Column -->
    <ng-container matColumnDef="fees">
      <th mat-header-cell *matHeaderCellDef>Fees</th>
      <td mat-cell *matCellDef="let element">{{ element.fees }}</td>
    </ng-container>

    <!-- Balance Value Column -->
    <ng-container matColumnDef="balance">
      <th mat-header-cell *matHeaderCellDef>Balance</th>
      <td style="color: darkred" mat-cell *matCellDef="let element">
        {{ element.balance }}
      </td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <th mat-header-cell mat-sort-header [disabled]="recent" *matHeaderCellDef>
        Status
      </th>
      <td mat-cell *matCellDef="let element">
        {{ element.transactionStatusName }}
      </td>
    </ng-container>

    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
        <div class="transaction-element-detail" [@detailExpand]="
            element == selectedTransaction ? 'expanded' : 'collapsed'
          ">
          <div class="transaction-element-amounts">
            <div class="transaction-element-amount-lines">
              Spent:
              <span class="transaction-element-amount-values">
                {{ element.amountToSpend | number: "1.0-6" }}
                {{ element.currencyToSpend }}
              </span>
            </div>
            <div class="transaction-element-amount-lines">
              Received:
              <span class="transaction-element-amount-values">
                {{ element.amountToReceive | number: "1.0-6" }}
                {{ element.currencyToReceive }}
              </span>
            </div>
          </div>
          <div class="transaction-element-payment">
            <app-dropdown-item itemValue="{{ element?.instrumentDetails?.title }}"
              imageClass="{{ element?.instrumentDetails?.imgClass }}"
              imageSource="{{ element?.instrumentDetails?.imgSource }}">
            </app-dropdown-item>
          </div>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns" class="transaction-element-row"
      [class.transaction-expanded-row]="selectedTransaction === row"
      (click)="selectedTransaction = selectedTransaction === row ? null : row"></tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="transaction-detail-row"></tr>
  </table>

  <mat-paginator *ngIf="errorMessage === '' && recent === false" class="data-table" [length]="transactionCount"
    [pageSize]="pageSize" [pageSizeOptions]="[25, 50, 100]" showFirstLastButtons (page)="handlePage($event)">
  </mat-paginator>
</div>