<h2>{{!form.value.id ? "Create widget" : "Change widget"}}</h2>

<form [formGroup]="form" (ngSubmit)="onSubmit()">

    <mat-form-field class="form-element">
        <mat-label>User</mat-label>
        <input type="text"
               placeholder="Select user"
               aria-label="User"
               matInput
               formControlName="user"
               (input)="handleUserInputChange($event)"
               [matAutocomplete]="autoUser">
        <mat-autocomplete #autoUser="matAutocomplete" [displayWith]="formatUserValue">
            <mat-option *ngFor="let option of filteredUserOptions" [value]="option">
                {{option.fullName + (option.email ? ' ('+  option.email + ')'  : '')}}
            </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="this.form.controls.user.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <app-details-attribute *ngIf="form.value.id" linkUrl=true label="Widget address" [value]="widgetLink"></app-details-attribute>

    <mat-form-field class="form-element">
        <mat-label>Widget name</mat-label>
        <input matInput formControlName="name" required/>
        <mat-error *ngIf="this.form.controls.name.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Description</mat-label>
        <input matInput formControlName="description" />
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Countries</mat-label>
        <mat-chip-list #countryChipList aria-label="Country selection">
            <mat-chip *ngFor="let opt of this.form.controls.countries.value" (removed)="removeCountryOption(opt)">
                {{opt.name}}
                <mat-icon matChipRemove matTooltip="Remove country" matTooltipClass="info-tooltip">cancel
                </mat-icon>
            </mat-chip>
            <input #countrySearchInput
                   placeholder="Countries"
                   [matAutocomplete]="countryAuto"
                   [matChipInputFor]="countryChipList"
                   (input)="handleCountrySearchInputChange($event)"
                   (matChipInputTokenEnd)="handleCountryOptionAdded($event)">
        </mat-chip-list>
        <mat-autocomplete #countryAuto="matAutocomplete" (optionSelected)="handleCountryOptionSelected($event)">
            <mat-option *ngFor="let item of filteredCountryOptions" [value]="item" [id]="item.code2">
                <app-dropdown-item itemValue="{{item.name}}" imageClass="country-flag"
                                   imageSource="assets/svg-country-flags/{{getCountryFlag(item.code2)}}">
                </app-dropdown-item>
            </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="this.form.controls.countries.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Currencies from</mat-label>
        <mat-select formControlName="currenciesFrom" multiple>
            <mat-option *ngFor="let item of currencyOptions" [value]="item.id">
                {{item.name}}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="this.form.controls.currenciesFrom.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>


    <mat-form-field class="form-element">
        <mat-label>Currencies to</mat-label>
        <mat-select formControlName="currenciesTo" multiple>
            <mat-option *ngFor="let item of currencyOptions" [value]="item.id">
                {{item.name}}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="this.form.controls.currenciesTo.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Destination address</mat-label>
        <input matInput formControlName="destinationAddress" />
        <mat-error *ngIf="this.form.controls.destinationAddress.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Payment Methods</mat-label>
        <mat-select formControlName="instruments" multiple>
            <mat-option *ngFor="let item of instrumentOptions" [value]="item.id">
                {{item.name}}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="this.form.controls.instruments.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Liquidity provider</mat-label>
        <mat-select formControlName="liquidityProvider">
            <mat-option *ngFor="let item of liquidityProviderOptions" [value]="item.id">
                {{item.name}}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="this.form.controls.liquidityProvider.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Payment providers</mat-label>
        <mat-select formControlName="paymentProviders" multiple>
            <mat-option *ngFor="let item of paymentProviderOptions" [value]="item.id">
                {{item.name}}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="this.form.controls.paymentProviders.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
        <mat-label>Transaction types</mat-label>
        <mat-select formControlName="transactionTypes" multiple>
            <mat-option *ngFor="let item of transactionTypeOptions" [value]="item.id">
                {{item.name}}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="this.form.controls.transactionTypes.hasError('required')">
            Mandatory field
        </mat-error>
    </mat-form-field>

    <div class="panel-actions">
        <button mat-flat-button color="primary" type="submit">
            SAVE
        </button>
        <button *ngIf="!!this.form.value.id" mat-flat-button color="warn" type="button" (click)="onDelete()">
            DELETE
        </button>
        <button mat-flat-button (click)="onCancel()" type="button">
            CANCEL
        </button>
    </div>
</form>
