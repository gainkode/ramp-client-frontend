
<div class="order-details__wrapper">
    <div class="order-details__content order-details__content--first">

        <div class="__widget-title-container__ order-details__content-header m-0">
            <div class="__widget-title-logo-container d-flex m-0 ms-1">
              <img class="__widget-title-logo" width="160" [src]="logoSrc" [alt]="logoAlt">

              <ng-container *ngIf="themeService.theme$ | async as theme">
                <button 
                  type="button" 
                  mat-icon-button 
                  [title]="theme === 'light' ? ('widget-internal-overview.theme_hint-light' | transloco) : ('widget-internal-overview.theme_hint-dark' | transloco) "
                  [ngClass]="{'moon': theme === 'dark', 'sun': theme === 'light'}"
                  (click)="themeService.toggleTheme()">
                  <mat-icon>
                    {{ theme === 'light' ? 'dark_mode' : 'light_mode' }}
                  </mat-icon>
                </button>
              </ng-container>

                <div class="navbar">
                    <div class="navbar__item">
                        <a class="navbar__item-group-link">{{activeLang}}
                            <i style="display: none;" class="fa fa-caret-down" aria-hidden="true"></i></a>
                        <ul class="navbar__item-group navbar__item-group--left">
                            <li *ngFor="let lang of availableLangs" class="navbar__subitem">
                                <a class="navbar__link navlink" (click)="onLangSelect(lang)">
                                    {{lang.label}}
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="order-details__content-header-buttons" 
                [class.order-details__content-header-buttons--inactive]="false">
                <div *ngIf="isBuyButton" 
                    class="order-details__content-header-button"
                    [class.order-details__content-header-button--active]="currentTransaction === TRANSACTION_TYPE.Buy"
                    (click)="toggleTransationType(TRANSACTION_TYPE.Buy)">
                    {{'widget-internal-overview.transaction-type_button-buy' | transloco}}
                </div>
                <div *ngIf="isSellButton"
                    class="order-details__content-header-button"
                    [class.order-details__content-header-button--active]="currentTransaction === TRANSACTION_TYPE.Sell"
                    (click)="toggleTransationType(TRANSACTION_TYPE.Sell)">
                    {{'widget-internal-overview.transaction-type_button-sell' | transloco}}
                </div>
            </div>
        </div>

        <form [formGroup]="dataForm">
            <app-widget-input-group 
                [label]="spendTitle" 
                [boxFieldName]="'amountSpend'"
                [boxField]="amountSpendField" 
                [comboField]="currencySpendField" 
                [comboFieldName]="'currencySpend'"
                [comboList]="spendCurrencyList" 
                [disabled]="maxSellAmountLoading"
                [errorMessages]="amountSpendErrorMessages">
            </app-widget-input-group>
    
            <app-widget-input-group
                [label]="receiveTitle" 
                [boxFieldName]="'amountReceive'"
                [boxField]="amountReceiveField" 
                [comboField]="currencyReceiveField" 
                [comboFieldName]="'currencyReceive'"
                [comboList]="receiveCurrencyList" 
                [errorMessages]="amountReceiveErrorMessages">
            </app-widget-input-group>
    
            <div *ngIf="!settings.embedded" class="mt-3 order-details__theme">
                <app-widget-rate 
                    class="__widget-rate-container"
                    [currentTransaction]="currentTransaction"
                    [spendList]="spendCurrencyList" 
                    [receiveList]="receiveCurrencyList" 
                    [currencySpend]="currencySpendField.value"
                    [currencyReceive]="currencyReceiveField.value" 
                    [showRate]="settings.showRate !== false" 
                    [rate]="summary?.rate">
                </app-widget-rate>
            </div>

            <app-widge-internal-overview-details
                [amountSpendField]="amountSpendField"
                [currencySpend]="currencySpendField.value"
                [currencyReceive]="currencyReceiveField.value" 
                [spendList]="spendCurrencyList"
                [receiveList]="receiveCurrencyList" 
                [mobileSummary]="mobileSummary"
                [summary]="summary">
            </app-widge-internal-overview-details>

           <ng-container *ngIf="isSinglePage">
                <div class="mt-3">
                    <app-form-textbox 
                        formControlName="email" 
                        [placeholder]="'widget-internal-overview.field_email' | transloco"
                        [maxlength]="50" 
                        [errorMessages]="emailErrorMessages" 
                        [separator]="true">
                    </app-form-textbox>

                    <app-form-textbox *ngIf="showWallet"
                        formControlName="wallet" 
                        [placeholder]="'widget-internal-overview.field_wallet' | transloco" [maxlength]="120"
                        [errorMessages]="walletErrorMessages" >
                    </app-form-textbox>

                    <div *ngIf="walletField?.hasError('walletAddress')" class="__form-assist __form-assist-error">
                        {{'widget-internal-overview.field_wallet-error-invalid' | transloco}}
                    </div>
                </div>
           </ng-container>
    
            <div *ngIf="hideProceedButton" class="button-proceed-wrapper">
                <span *ngIf="isSinglePage" class="order-details__overview-terms">
                    {{'widget-internal-overview.terms_part-1' | transloco}}
                    <a target="_blank" [href]="termsLink">
                        {{'widget-internal-overview.terms_part-2' | transloco}}
                    </a> {{'widget-internal-overview.terms_part-3' | transloco}} 
                    <a target="_blank" [href]="privacyLink">
                        {{'widget-internal-overview.terms_part-4' | transloco}}
                    </a>
                </span>
                <button type="button" mat-raised-button [disabled]="!isOrderProceedFormValid" (click)="onProceed()">
                    <span class="d-flex"> 
                        {{'widget-internal-overview.proceed_button-label' | transloco}}
                         <span class="tx-30">&#183;</span> 
                         {{'widget-internal-overview.proceed_button-label-total' | transloco}} {{amountSpendField.valid ? amountSpendField.value : '---'}}</span>
                </button>
            </div>
        </form>
    
        <div class="__widget-data-error">
            {{errorMessageData}}
        </div>
    </div>

    <div class="order-details__content order-details__content--second" 
        [class.order-details__content--active]="isSecondPartActive && !isOrderDetailsComplete" 
        [ngClass]="isSecondPartActive && !isOrderDetailsComplete ? 'd-flex' : 'd-none'" >
        <form class="order-details__overview" [formGroup]="dataForm">
          <div class="order-details__overview-details">
            <h3 class="order-details__overview-title">
                {{'widget-internal-overview.order-details_title2' | transloco}}
            </h3>
            <div class="order-details__overview-details-item">
                <app-form-textbox 
                    formControlName="email" 
                    [label]="'widget-internal-overview.field_email' | transloco"
                    [maxlength]="50" 
                    [errorMessages]="emailErrorMessages" 
                    [separator]="true">
                </app-form-textbox>
            
                <app-form-textbox 
                    *ngIf="showWallet"
                    formControlName="wallet" 
                    [label]="'widget-internal-overview.field_wallet' | transloco" [maxlength]="120"
                    [errorMessages]="walletErrorMessages" >
                </app-form-textbox>
        
                <div *ngIf="walletField?.hasError('walletAddress')" class="__form-assist __form-assist-error">
                    {{'widget-internal-overview.field_wallet-error-invalid' | transloco}}
                </div>
            </div>
          </div>
          <span class="order-details__overview-terms">
            {{'widget-internal-overview.terms_part-1' | transloco}} 
            <a target="_blank" [href]="termsLink">
                {{'widget-internal-overview.terms_part-2' | transloco}} 
            </a> {{'widget-internal-overview.terms_part-2' | transloco}}  
            <a target="_blank" [href]="privacyLink">
                {{'widget-internal-overview.terms_part-4' | transloco}} 
            </a>
          </span>
          <div class="order-details__overview-actions">
            <button type="button" mat-raised-button (click)="onCancel()">
                {{'global.widget_btn-back' | transloco}}
            </button>
            <button type="button" mat-raised-button [disabled]="!isOrderDetailsFormValid" (click)="onSubmit()">
                {{'global.widget_btn-next' | transloco}}
            </button>
          </div>
      </form>
    </div>
</div>
